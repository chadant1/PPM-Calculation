<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Art of Drink: PPM Volume Calculator (Cleaned)</title>
    <style>
        /* --- FIX: Ensure scrolling works on the whole page --- */
        html, body {
            height: 100%; /* Ensure both are 100% of the viewport */
        }
        
        /* --- General Styling & Background --- */
        body {
            font-family: 'Consolas', 'Courier New', monospace;
            background-color: #0d1117; /* Dark, high-tech background */
            color: #00ff00; /* Neon green text for a "tech" feel */
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh; /* Set minimum height to 100% of viewport height */
            position: relative;
            overflow-y: auto; /* Allows vertical scrolling when content exceeds viewport */
            overflow-x: hidden; /* Prevent horizontal scrolling */
        }

        /* --- "Art of Drink" Tiling Effect in Background --- */
        .background-watermark {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            opacity: 0.05; /* Very subtle */
            z-index: -1;
            background-image: repeating-linear-gradient(
                45deg,
                rgba(0, 255, 0, 0.05),
                rgba(0, 255, 0, 0.05) 50px,
                transparent 50px,
                transparent 100px
            );
        }
        .background-watermark::before {
            content: "Art of Drink Art of Drink Art of Drink Art of Drink Art of Drink Art of Drink Art of Drink";
            position: absolute;
            white-space: pre;
            line-height: 20vh;
            font-size: 5vw;
            font-weight: bold;
            color: rgba(0, 255, 0, 0.03);
            transform: rotate(-10deg);
            width: 200%;
            text-align: center;
        }

        /* --- Main Container & Titles --- */
        .container {
            background-color: #161b22;
            border: 1px solid #30363d;
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 0 20px rgba(0, 255, 0, 0.5), 0 0 50px rgba(0, 255, 0, 0.1);
            width: 90%;
            max-width: 800px;
            z-index: 10;
        }
        h1, h2 {
            text-align: center;
            color: #00ff00;
            text-shadow: 0 0 5px #00ff00;
        }
        h1 {
            font-size: 2.5em;
            margin-bottom: 5px;
        }
        h2 {
            font-size: 1.5em;
            margin-top: 0;
            border-bottom: 2px solid #00ff00;
            padding-bottom: 10px;
            margin-bottom: 20px;
        }

        /* --- Input/Output Sections --- */
        .section {
            display: flex;
            flex-direction: column;
            margin-bottom: 25px;
            padding: 15px;
            border: 1px solid #00ff00;
            border-radius: 8px;
            background-color: #0e1218;
            position: relative;
            overflow: hidden;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-size: 1.1em;
            color: #00ff00;
        }

        input[type="number"] {
            width: calc(100% - 22px);
            padding: 10px;
            margin-bottom: 15px;
            border: 1px solid #00ff00;
            background-color: #0d1117;
            color: #00ff00;
            font-size: 1em;
            border-radius: 4px;
            box-shadow: inset 0 0 5px rgba(0, 255, 0, 0.5);
            transition: all 0.3s;
        }
        input[type="number"]:focus {
            outline: none;
            border-color: #33ff33;
            box-shadow: 0 0 10px #33ff33, inset 0 0 8px #33ff33;
        }

        button {
            background-color: #00ff00;
            color: #161b22;
            padding: 12px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1.2em;
            font-weight: bold;
            transition: background-color 0.3s, transform 0.1s, box-shadow 0.3s;
            box-shadow: 0 4px 15px rgba(0, 255, 0, 0.4);
            margin-top: 10px;
        }
        button:hover {
            background-color: #33ff33;
            box-shadow: 0 6px 20px rgba(0, 255, 0, 0.6);
        }
        button:active {
            transform: scale(0.98);
        }

        .result {
            margin-top: 15px;
            padding: 10px;
            background-color: #003300;
            border: 1px dashed #00ff00;
            border-radius: 4px;
            font-size: 1.3em;
            text-align: center;
        }
        
        .note {
            font-size: 0.9em;
            color: #88ff88;
            text-align: center;
            margin-top: 10px;
        }

        /* --- Liquid Effect (Beaker/Container Visualization) --- */
        .liquid-container {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            z-index: -5; /* Place behind inputs/labels */
        }
        .liquid-wave {
            position: absolute;
            bottom: -50px; /* Start wave below the section to hide the bottom curve */
            left: 0;
            width: 200%;
            height: 100px;
            background-color: rgba(0, 255, 0, 0.2); /* Light green liquid color */
            border-radius: 50% / 100%;
            transform: translateX(0);
            animation: wave 5s linear infinite;
        }
        /* Second wave for a more complex liquid motion */
        .liquid-wave:nth-child(2) {
            bottom: -40px;
            left: -50%;
            background-color: rgba(0, 255, 0, 0.15);
            animation: wave 7s linear infinite reverse;
        }

        @keyframes wave {
            0% { transform: translateX(0) rotate(0deg); }
            100% { transform: translateX(-50%) rotate(0deg); }
        }

        /* Apply the liquid effect to the sections */
        #calculator-section .liquid-container,
        #target-section .liquid-container {
            z-index: -1;
            /* For the first section, let's make the liquid a bit higher */
            bottom: 50px;
        }
        #calculator-section .liquid-wave {
            bottom: -40px; /* Adjust as needed for visual effect */
        }
        #target-section .liquid-wave {
            bottom: -60px; /* Different level for visual distinction */
            background-color: rgba(0, 100, 255, 0.2); /* Blue liquid for a different calculation */
        }
        #target-section .liquid-wave:nth-child(2) {
            background-color: rgba(0, 100, 255, 0.15);
        }

    </style>
</head>
<body>

    <div class="background-watermark"></div>

    <div class="container">
        <h1>Art of Drink</h1>
        <h2>Molecular Mixing Module</h2>
        <p class="note">**NOTE:** Calculations assume a water-like density of 1.0 g/mL. The PPM calculation uses solute mass (g) plus solvent volume (mL) for the total solution mass (g).</p>

        <div id="calculator-section" class="section">
            <div class="liquid-container">
                <div class="liquid-wave"></div>
                <div class="liquid-wave"></div>
            </div>
            <h3>Original Solution Data & PPM</h3>
            <p>Input your existing solution's solute and solvent to determine its concentration (PPM).</p>

            <label for="solute-grams">Solute Mass (grams) in Original Solution:</label>
            <input type="number" id="solute-grams" min="0" placeholder="e.g., 5.0" required>

            <label for="solvent-ml">Solvent Volume (milliliters) in Original Solution:</label>
            <input type="number" id="solvent-ml" min="1" placeholder="e.g., 1000" required>

            <button onclick="calculatePPM()">COMPUTE ORIGINAL PPM</button>

            <div id="ppm-result" class="result">
                --- Initial PPM will appear here ---
            </div>
             <input type="hidden" id="original-ppm-value">
            <input type="hidden" id="original-concentration-g-per-ml">
        </div>

        <div id="target-section" class="section">
            <div class="liquid-container">
                <div class="liquid-wave"></div>
                <div class="liquid-wave"></div>
            </div>
            <h3>Calculate Required Original Volume</h3>
            <p>Input the desired PPM to find the volume of your original solution needed to make a final 1 Liter solution.</p>

            <label for="target-ppm">Desired PPM for Final 1000 mL Solution:</label>
            <input type="number" id="target-ppm" min="0" placeholder="e.g., 50">

            <button onclick="calculateRequiredVolume()">CALCULATE REQUIRED VOLUME</button>

            <div id="target-result" class="result">
                --- Required Volume of Original Solution will appear here ---
            </div>
        </div>

    </div>

    <script>
        /**
         * Part 1: Calculates the PPM and concentration of the original solution.
         * Stores the concentration in a hidden field for use in Part 2.
         */
        function calculatePPM() {
            const soluteGrams = parseFloat(document.getElementById('solute-grams').value);
            const solventML = parseFloat(document.getElementById('solvent-ml').value);
            const resultElement = document.getElementById('ppm-result');
            
            if (isNaN(soluteGrams) || isNaN(solventML) || solventML <= 0) {
                resultElement.textContent = ">>> INPUT ERROR: Please enter valid positive numbers for Solute and Solvent.";
                return;
            }

            // A. PPM Calculation (Mass/Mass - standard chemical definition)
            const soluteMass_mg = soluteGrams * 1000;
            const solutionMass_kg = (soluteGrams + solventML) / 1000; // Total mass in kg
            
            if (solutionMass_kg === 0) {
                 resultElement.textContent = ">>> CALCULATION ERROR: Total solution mass is zero.";
                 return;
            }
            const ppm = soluteMass_mg / solutionMass_kg;

            // B. Concentration Calculation (Mass/Volume - required for mixing dilution)
            // Concentration = Solute mass (g) / Solution volume (mL)
            // Assuming Solution Volume (mL) is approximated by Solute Mass (g) + Solvent Volume (mL)
            const solutionVolume_ml = soluteGrams + solventML; // Approximation
            const concentration_g_per_ml = soluteGrams / solutionVolume_ml; 
            
            // Store results for the next calculation
            document.getElementById('original-ppm-value').value = ppm.toFixed(2);
            document.getElementById('original-concentration-g-per-ml').value = concentration_g_per_ml;
            
            // Display result - REMOVED LATEX
            resultElement.innerHTML = `
                <span style="color:#00ff00; font-weight:bold;">CALCULATED ORIGINAL PPM:</span>
                <br>
                ${ppm.toFixed(2)} PPM
            `;
            console.log(`Original PPM: ${ppm.toFixed(2)}, Concentration: ${concentration_g_per_ml.toFixed(6)} g/mL`);
        }

        /**
         * Part 2: Calculates the required volume (in mL) of the original solution.
         */
        function calculateRequiredVolume() {
            const targetPPM = parseFloat(document.getElementById('target-ppm').value);
            const resultElement = document.getElementById('target-result');
            const originalConcentration = parseFloat(document.getElementById('original-concentration-g-per-ml').value);

            if (isNaN(targetPPM) || targetPPM < 0) {
                resultElement.textContent = ">>> INPUT ERROR: Please enter a valid non-negative number for Target PPM.";
                return;
            }
            
            if (isNaN(originalConcentration) || originalConcentration === 0) {
                resultElement.textContent = ">>> CALCULATION ERROR: Please COMPUTE ORIGINAL PPM first.";
                return;
            }

            const targetSolutionMass_kg = 1.0; // Target is a 1 Liter solution (approx 1 kg)

            // 1. Calculate the total solute mass (g) needed in the final 1000 mL (1 kg) solution
            // Required Solute Mass (mg) = Target PPM * Target Solution Mass (kg)
            const requiredMilligrams = targetPPM * targetSolutionMass_kg;
            const requiredGrams = requiredMilligrams / 1000;

            // 2. Calculate the required volume of the original solution to supply that mass
            // Volume required (mL) = Required Solute Mass (g) / Original Concentration (g/mL)
            const requiredVolumeML = requiredGrams / originalConcentration;
            
            const finalVolumeML = 1000.0;
            const solventToMix = finalVolumeML - requiredVolumeML;

            if (requiredVolumeML > finalVolumeML) {
                 // Cleaned up the error message output
                 resultElement.innerHTML = `
                    <span style="color:#ff5555; font-weight:bold;">MIXING IMPOSSIBLE:</span>
                    <br>
                    Target PPM (${targetPPM}) is too high. 
                    <br>
                    Required volume of original solution (${requiredVolumeML.toFixed(2)} mL) exceeds the final 1000 mL volume.
                `;
                return;
            }

            // Display result - CLEANED UP OUTPUT
            resultElement.innerHTML = `
                <span style="color:#33ffff; font-weight:bold;">MIXING PROTOCOL (For Final 1000 mL Solution):</span>
                <br><br>
                ADD **${requiredVolumeML.toFixed(2)} mL** OF ORIGINAL SOLUTION
                <br>
                ADD **${solventToMix.toFixed(2)} mL** OF PURE SOLVENT
                <br>
                <span style="font-size:0.8em; color: #88ff88; margin-top: 10px;">(Total final volume is approximately 1000 mL)</span>
            `;
            console.log(`Required Volume Calculated: ${requiredVolumeML.toFixed(2)} mL`);
        }
    </script>
</body>
</html>